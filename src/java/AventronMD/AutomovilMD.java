/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. */package AventronMD;import AventronDP.AutomovilDP;import java.sql.Blob;import java.sql.Connection;import java.sql.DriverManager;import java.sql.ResultSet;import java.sql.SQLException;import java.sql.Statement;import java.util.ArrayList;import java.util.Date;import java.util.LinkedList;import java.util.List;import javax.naming.Context;import javax.naming.InitialContext;import javax.naming.NamingException;import javax.sql.DataSource;/** * * * * @author dagom * */public class AutomovilMD {    private AutomovilDP automovilDP;    private Connection con;    private Statement stm;    private String cadena;    private ResultSet rs;    private String error;    ArrayList<AutomovilDP> nueva = new ArrayList();    public AutomovilMD(AutomovilDP automovilDP) {        this.automovilDP = automovilDP;    }    public AutomovilDP recuperarAutomovil() {        AutomovilDP automovilDPL = new AutomovilDP();        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            this.cadena = "SELECT * FROM AUTOMOVIL WHERE AUTOPLACA = '" + automovilDP.getAutoPlaca()                    + "'";            rs = this.stm.executeQuery(this.cadena);            while (rs.next()) {                String autoPlaca = rs.getString("AUTOPLACA");                String usuarioCI = rs.getString("CIUSUARIO");                Date autoAnio = rs.getDate("AUTOANIO");                int autoAsientosMaximos = rs.getInt("AUTOASIENTOSMAXIMOS");                Blob autoImagen = rs.getBlob("AUTOIMAGEN");                /*System.out.println(coffeeName + "\t" + supplierID +                                   "\t" + price + "\t" + sales +                                   "\t" + total);*/                automovilDPL = new AutomovilDP(autoPlaca, usuarioCI, autoAnio, autoAsientosMaximos, autoImagen);            }            con.close();            this.stm.close();        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);    }           }        return automovilDPL;    }    public LinkedList<AutomovilDP> recuperarAutomoviles(AutomovilDP automovilDP) {        //List<AutomovilDP> retorno = new List<AutomovilDP>();        //AutomovilDP nuevo = new AutomovilDP();        //List<AutomovilDP> retrono = new List<AutomovilDP>();        LinkedList<AutomovilDP> retorno1 = new LinkedList<>();        AutomovilDP automovilDPL = new AutomovilDP();        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            this.cadena = "SELECT * FROM AUTOMOVIL WHERE CIUSUARIO = '" + automovilDP.getUsuarioCI()                    + "'";            rs = this.stm.executeQuery(this.cadena);            while (rs.next()) {                String autoPlaca = rs.getString("AUTOPLACA");                String usuarioCI = rs.getString("CIUSUARIO");                Date autoAnio = rs.getDate("AUTOANIO");                int autoAsientosMaximos = rs.getInt("AUTOASIENTOSMAXIMOS");                Blob autoImagen = rs.getBlob("AUTOIMAGEN");                /*System.out.println(coffeeName + "\t" + supplierID +                                   "\t" + price + "\t" + sales +                                   "\t" + total);*/                automovilDPL = new AutomovilDP(autoPlaca, usuarioCI, autoAnio, autoAsientosMaximos, autoImagen);                retorno1.add(automovilDPL);            }            con.close();            this.stm.close();        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);    }           }        return retorno1;    }    public String conversorDate() {        Date hola = new Date(this.automovilDP.getAutoAnio().getTime());        String[] elementos = hola.toString().split(" ");        return elementos[5] + "-" + elementos[1] + "-" + elementos[2];    }    public void insertarAutomovil() {        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            cadena = "INSERT INTO AUTOMOVIL  (AUTOPLACA , CIUSUARIO, AUTOANIO,  AUTOASIENTOSMAXIMOS , AUTOIMAGEN) values('"                    + automovilDP.getAutoPlaca() + "','"                    + automovilDP.getUsuarioCI() + "', to_date('"                    + this.conversorDate() + "','yyyy-mm-dd'),"                    + automovilDP.getAutoAsientosMaximos() + ","                    + automovilDP.getAutoImagen() + ")";            this.stm.executeUpdate(this.cadena);            this.con.close();            this.stm.close();        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        }    }    public void eliminarAutomovil() {        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            this.cadena = "DELETE FROM AUTOMOVIL WHERE AUTOPLACA = " + automovilDP.getAutoPlaca();            this.stm.executeUpdate(this.cadena);            con.close();            this.stm.close();        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        }    }    public void actualizarAutomovil() {        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            this.cadena = "UPDATE AUTOMOVIL  SET AUTOANIO= '" + automovilDP.getAutoAnio()                    + "',  AUTOASIENTOSMAXIMOS = " + automovilDP.getAutoAsientosMaximos()                    + ", AUTOIMAGEN =" + automovilDP.getAutoImagen() + "WHERE AUTOPLACA = " + automovilDP.getAutoPlaca();            this.stm.executeUpdate(this.cadena);            con.close();            this.stm.close();        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        }    }    public boolean validarAutomovil() {        boolean resultado = true;        /* this.stm = this.con.createStatement();            //actividad = actividad1;            //String detalle = auto.getAutoPlaca();            this.cadena = "select * from automovil where autoPlaca ='" + auto.getAutoPlaca() + "'";            ResultSet rs = this.stm.executeQuery(this.cadena);            if (rs.next()) {                error = "El usuario que desea crear ya existe.";                con.close();                this.stm.close();                this.cadena = "";            } else {*/        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            this.cadena = "SELECT * from AUTOMOVIL WHERE AUTOPLACA='" + this.automovilDP.getAutoPlaca() + "'";            this.rs = this.stm.executeQuery(this.cadena);            if (this.rs != null) {                resultado = false;            }            this.con.close();            this.stm.close();        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        }        return resultado;    }    public AutomovilDP ConsultaporParametros1(AutomovilDP auto) {        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            this.cadena = "SELECT * FROM AUTOMOVIL WHERE AUTOPLACA = '" + auto.getAutoPlaca()                    + "'";            rs = this.stm.executeQuery(this.cadena);            while (rs.next()) {                String autoPlaca = rs.getString("AUTOPLACA");                String usuarioCI = rs.getString("CIUSUARIO");                Date autoAnio = rs.getDate("AUTOANIO");                int autoAsientosMaximos = rs.getInt("AUTOASIENTOSMAXIMOS");                Blob autoImagen = rs.getBlob("AUTOIMAGEN");                auto = new AutomovilDP(autoPlaca, usuarioCI, autoAnio, autoAsientosMaximos, autoImagen);            }            con.close();            this.stm.close();        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);    }           }        return auto;    }    public AutomovilDP ConsultaporParametros2(String placa) {        try {            DataSource DSAutomovil = this.getAventronPool();            this.con = DSAutomovil.getConnection();            this.stm = this.con.createStatement();            this.cadena = "SELECT * FROM AUTOMOVIL WHERE AUTOPLACA = '" + placa                    + "'";            rs = this.stm.executeQuery(this.cadena);            while (rs.next()) {                String autoPlaca = rs.getString("AUTOPLACA");                String usuarioCI = rs.getString("CIUSUARIO");                Date autoAnio = rs.getDate("AUTOANIO");                int autoAsientosMaximos = rs.getInt("AUTOASIENTOSMAXIMOS");                Blob autoImagen = rs.getBlob("AUTOIMAGEN");                //auto = new AutomovilDP(autoPlaca, usuarioCI, autoAnio, autoAsientosMaximos, autoImagen);                automovilDP = new AutomovilDP(autoPlaca, usuarioCI, autoAnio, autoAsientosMaximos, autoImagen);            }            con.close();            this.stm.close();            return automovilDP;        } catch (NamingException ex) {            /////Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);        } catch (SQLException ex) {            //Logger.getLogger(Actividad.class.getName()).log(Level.SEVERE, null, ex);    }           }        return automovilDP;    }    private DataSource getAventronPool() throws NamingException {        Context c = new InitialContext();        return (DataSource) c.lookup("java:comp/env/AventronPool");    }    public ArrayList consultaPorUsuario(String userCI) throws NamingException, SQLException {        DataSource DSUsuario = this.getAventronPool();        Connection con = DSUsuario.getConnection();        Statement st = con.createStatement();        String cadena = "";        cadena = "select * from AUTOMOVIL where CIUSUARIO='" + userCI + "'";        ResultSet rs = st.executeQuery(cadena);        while (rs.next()) {            String autoPlaca = rs.getString("AUTOPLACA");            String usuarioCI = rs.getString("CIUSUARIO");            Date autoAnio = rs.getDate("AUTOANIO");            int autoAsientosMaximos = rs.getInt("AUTOASIENTOSMAXIMOS");            Blob autoImagen = rs.getBlob("AUTOIMAGEN");            //auto = new AutomovilDP(autoPlaca, usuarioCI, autoAnio, autoAsientosMaximos, autoImagen);            automovilDP = new AutomovilDP(autoPlaca, usuarioCI, autoAnio, autoAsientosMaximos, autoImagen);            this.nueva.add(automovilDP);        }        con.close();        st.close();        return this.nueva;    }}